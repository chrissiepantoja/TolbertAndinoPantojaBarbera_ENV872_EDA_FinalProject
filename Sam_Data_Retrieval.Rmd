---
title: "Scrape.it for Final Project"
author: "Sam Tolbert"
date: "2024-11-27"
output:
  pdf_document: default
  html_document: default
---


testing testing git

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(rvest)
library(purrr)
library(lubridate)
library(here)
library(dplyr)

#install.packages("dataRetrieval")
library(dataRetrieval)

install.packages("forecast")

```

Retrieving data for Sugar Grove Gage from USGS using USGS's dataRetrieval package.
I find its siteNumber is 03479000 from "https://waterdata.usgs.gov/monitoring-location/03479000/#parameterCode=
00060&period=P7D&showMedian=false".
```{r echo=TRUE}

siteNumberSugarGrove<-('03479000')

#I find the MetaData for the site
SugarGroveMeta <- whatNWISsites(siteNumbers = siteNumberSugarGrove)
print(SugarGroveMeta) 

#I then use sitedata function to look at what data is available
SugarGroveSiteData<-suppressWarnings(whatNWISdata(siteNumber=siteNumberSugarGrove))
```

Looking at what data is available, I see that the parameter codes (parmcodes)
for stream discharge (00060) , precipitation (00045), and gage height (0065).
I also see that our relevant stat codes are daily mean (0003) and sum (00006)
#

```{r message=FALSE, warning=FALSE}
pcodes<-c('00060','00045','00065') #parameters discharge, precip, and gage height
scode<-c('00003', '00006') #daily mean and daily accumulated


SugarGroveData<-readNWISdata( #dataRetrival function from USGS API
  siteNumbers = siteNumberSugarGrove,
  parameterCd= pcodes,
  statCd= scode,
  startDate= ymd('1900-01-01'),
  endDate= Sys.Date()
)
  
#View(SugarGroveData)  
```

This is my data! However, I need to clean this up. 
First I want to remove the 'cd' columns that indicate if the data is official or 
provisional as this won't have a significant effect on our findings. 
We can mention that in our discussion of the meta data but its not 
worth a column in our df. 

Then I want to clearly label each column with its parameter and stat code:

```{r}
CleanedDataSugarGrove<-SugarGroveData%>% 
select(-ends_with("cd")) %>% #removing cd columns that indiciate provisional or offical data
  rename(
  'Total Daily Precipitation (Inches)' = X_00045_00006, #renaming columns
    'Mean Discharge' = X_00060_00003,
    'Mean Gage Height' = X_00065_00003
  )
  
View(CleanedDataSugarGrove)


```

I want to repeat this data retrieval and cleaning for two additional sites,
French Broad River in Asheville in Southwestern NC (03451500) 
and East Fork Pigeon River in far Southwestern NC near Canton (03456500) for
examinations of 3 different rivers in different parts of the state.

First I check the metadata and sitedata to see if similar data and parameters
are availale to compare to Sugar Grove

```{r}

#First the Asheville site

siteNumberAsheville<-('03451500')

#I find the MetaData for the site
AshevilleMeta <- whatNWISsites(siteNumbers = siteNumberAsheville)
print(AshevilleMeta) 

#I then use sitedata function to look at what data is available
AshevilleSiteData<-whatNWISdata(siteNumber=siteNumberAsheville)

```

Then I decide I want to create an easy data retrieval function for my chosen
parameters based on my previous retreival.

```{r}

WaterData.Function<-function(siteNo, pcode, scode){

SiteData<-readNWISdata(
  siteNumbers = siteNo,
  parameterCd= pcode,
  statCd= scode,
  startDate= ymd('1900-01-01'),
  endDate= Sys.Date()
)

  CleanData<-SiteData%>% 
select(-ends_with("cd")) %>% #removing cd columns that indiciate provisional or offical data
  rename(
  'Total Daily Precipitation (Inches)' = X_00045_00006, #renaming columns
    'Mean Discharge' = X_00060_00003,
    'Mean Gage Height' = X_00065_00003
  )
  
df_name<-paste0('CleanData_', siteNo)
assign(df_name, CleanData, envir= .GlobalEnv)

return(CleanData)
}
```

I run this function for Asheville's siteNo
```{r}
siteNoAsheville<-'03451500'

siteNo<-siteNoAsheville
pcode<-c('00060','00045','00065')
scode<-c('00003', '00006')

CleanedDataAsheville<-WaterData.Function(siteNo, pcode, scode)
#View(CleanedDataAsheville)


```

I then do the same for the Pigeon River Site and its site number

```{r}

siteNoPigeonRiver<-'03456500'

siteNo<-siteNoPigeonRiver
pcode<-c('00060','00045','00065')
scode<-c('00003', '00006')

CleanedDataPigeonRiver<-WaterData.Function(siteNo, pcode, scode)
#View(CleanedDataPigeonRiver)
  

```

##Data Visualization## 
```{r}

library(ggplot2)

AshevilleDailyDischargeLinePlot<-ggplot(CleanedDataAsheville, aes(
  x = dateTime, 
  y = `Mean Discharge`)) +
  geom_line(color = "green", size = 1) +  
 # geom_point(color = "darkgreen", size = 2) +  
  labs(
    title = "Mean Daily Discharge Over Time",
    subtitle = "Asheville(1954-2024)",
    x = "Date",
    y = "Mean Discharge (cubic meters per second)"
  ) +
  theme_minimal() 

print(AshevilleDailyDischargeLinePlot)

PigeonRiverDailyDischargeLinePlot<-ggplot(CleanedDataPigeonRiver, aes(
  x= dateTime,
  y= `Mean Discharge`)) +
  geom_line(color="purple")+
 # geom_point(color="maroon")+
  labs(
    title = "Mean Daily Discharge Over time",
    subtitle = "Pigeon River(1954-2024)",
    x= "Date",
    y= "Mean Discharge (cubic meters per second)"
  )+ theme_minimal()

print(PigeonRiverDailyDischargeLinePlot)

SugarGroveDailyDischargeLinePlot<-ggplot(CleanedDataSugarGrove, aes(
  x= dateTime,
  y= `Mean Discharge`)) +
  geom_line(color="blue")+
 # geom_point(color="darkblue")+
  labs(
    title = "Mean Daily Discharge Over time",
    subtitle = "Sugar Grove(1954-2024)",
    x= "Date",
    y= "Mean Discharge (cubic meters per second)"
  )+ theme_minimal()
 
print(SugarGroveDailyDischargeLinePlot) 


#note: what I am noticing is that we have a lot of daily data which is good when
#we take a closer look at Helene. I am going to do some work looking at the monthly
#mean daily precip for now- We will need to cut data in the future 1980-2024
#these do show the outliers which is kind of neat 


```

##Pigeon River Visualizations##
```{r}

#This is basically useless but I will keep it in here so we can see monthly

PRMonthlyMean <- CleanedDataPigeonRiver %>%
  mutate(dateTime = floor_date(dateTime, "month")) %>% #first day of the month
  group_by(dateTime) %>%
  summarize(`Mean Discharge` = mean(`Mean Discharge`, na.rm = TRUE))

#What I did here was aggregate the data so now we have a monthly mean 
#I made it just show up as the first day of the month 
#getting the mean value for the specific month 
#basically I am just playing with less data 

ggplot(PRMonthlyMean, aes(
  x= dateTime,
  y= `Mean Discharge`)) +
  geom_line(color="purple")+
  #geom_point(color="maroon")+
  labs(
    title = "Mean Monthly Discharge Over time",
    subtitle = "Pigeon River(1954-2024)",
    x= "Date",
    y= "Mean Discharge (cubic meters per second)")+ 
    theme_minimal()

str(CleanedDataPigeonRiver)

CleanedDataPigeonRiver <- CleanedDataPigeonRiver %>%
  mutate(dateTime = as.Date(dateTime))  

#okay I still don't like the visualization 
#I think we need to do a log scale 



```

##Pigeon River seasonal breakdown and log regression## 
```{r}
#I am now breaking the data into hurricane and frontal seasons 
#hurricane season is July to November 
#frontal season is December- June
#This info is from previous Hydrology project 

SeasonalCleanedDataPigeonRiver <- CleanedDataPigeonRiver %>%
  mutate(season = case_when(
    month(dateTime) %in% 7:11 ~ "Hurricane",  # July to November
    month(dateTime) %in% c(12, 1:6) ~ "Frontal"  # December to June
  ))

head(SeasonalCleanedDataPigeonRiver)

#Pigeon River Data is now in frontal and hurricane seasons with a new column
#called seasons 

PRHurricaneData <- SeasonalCleanedDataPigeonRiver %>%
  filter(season == "Hurricane")

PRFrontalData <- SeasonalCleanedDataPigeonRiver %>%
  filter(season == "Frontal")

#plotting the two seasons 

ggplot(SeasonalCleanedDataPigeonRiver, aes(
  x = dateTime, 
  y = `Mean Discharge`, 
  color = season)) +
  geom_point(size = 1) +  # Scatterplot
  labs(
    title = "Mean Daily Discharge During Hurricane and Frontal Seasons",
    subtitle = "Pigeon River (1954-2024",
    x = "Date",
    y = "Mean Daily Discharge (cfs)",
    color = "Season"
  ) +
  scale_color_manual(values = c("Hurricane" = "purple", "Frontal" = "blue"))  


ggplot(PRHurricaneData, aes(
  x = dateTime, 
  y = `Mean Discharge`)) +
  geom_point(color = "purple") +  # Points for yearly average precipitation
  geom_smooth(method = "lm", color = "black", se = TRUE) +  # Linear regression with confidence interval
  labs(
    title = "Trend in Precipitation During Hurricane Seasons",
    x = "Year",
    y = "Mean Precipitation (mm)"
  ) +
  theme_minimal()

#plotting a linear regression for hurricane season on the Pigeon River 

#log data 

ggplot(PRHurricaneData, aes(
  x = dateTime, y = log(`Mean Discharge`))) + 
  geom_point(color = "purple") +
  geom_smooth(method = "lm", color = "black", se = TRUE) +
  labs(
    title = "Log-Transformed Trend in Precipitation During Hurricane Seasons",
    subtitle = "Pigeon River (1954-2024)",
    x = "Year",
    y = "Log of Mean Precipitation (mm)"
  ) +
  theme_minimal()

#filtering data for years 1980-2024


PRYearFilteredData <- PRHurricaneData %>%
  filter(year(dateTime) >= 1980 & year(dateTime) <= 2024)

#View(PRYearFilteredData)

ggplot(PRYearFilteredData, aes(
  x = dateTime, 
  y = `Mean Discharge`)) +
  geom_point(color = "purple") +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  labs(
    title = "Trend in Precipitation During Hurricane Seasons (1980-2024)",
    subtitle = "Pigeon River",
    x = "Year",
    y = "Mean Precipitation (mm)"
  ) +
  theme_minimal()


ggplot(PRYearFilteredData, aes(
  x = dateTime, y = log(`Mean Discharge`))) + 
  geom_point(color = "purple") +
  geom_smooth(method = "lm", color = "black", se = TRUE) +
  labs(
    title = "Log-Transformed Trend in Precipitation During Hurricane Seasons",
    subtitle = "Pigeon River (180-2024)",
    x = "Year",
    y = "Log of Mean Precipitation (mm)"
  ) +
  theme_minimal()


```
##Asheville Data Visualization##
```{r}


SeasonalCleanedDataAsheville <- CleanedDataAsheville %>%
  mutate(season = case_when(
    month(dateTime) %in% 7:11 ~ "Hurricane",  # July to November
    month(dateTime) %in% c(12, 1:6) ~ "Frontal"  # December to June
  ))

head(SeasonalCleanedDataAsheville)

#Asheville Data is now in frontal and hurricane seasons with a new column
#called seasons 

AVHurricaneData <- SeasonalCleanedDataAsheville %>%
  filter(season == "Hurricane")

AVFrontalData <- SeasonalCleanedDataAsheville %>%
  filter(season == "Frontal")

#plotting the two seasons 

ggplot(SeasonalCleanedDataAsheville, aes(
  x = dateTime, 
  y = `Mean Discharge`, 
  color = season)) +
  geom_point(size = 1) +  # Scatterplot
  labs(
    title = "Mean Daily Discharge During Hurricane and Frontal Seasons",
    subtitle = "Asheville (1954-2024",
    x = "Date",
    y = "Mean Daily Discharge (cfs)",
    color = "Season"
  ) +
  scale_color_manual(values = c("Hurricane" = "darkgreen", "Frontal" = "lightgreen"))  
#this looks disgusting
#but from this we can see there is not much variance between seasonal precipitation 


ggplot(AVHurricaneData, aes(
  x = dateTime, 
  y = `Mean Discharge`)) +
  geom_point(color = "darkgreen") +  # Points for yearly average precipitation
  geom_smooth(method = "lm", color = "white", se = TRUE) +  # Linear regression with confidence interval
  labs(
    title = "Trend in Precipitation During Hurricane Seasons",
    subtitle = "Asheville",
    x = "Year",
    y = "Mean Precipitation"
  ) +
  theme_minimal()

#plotting a linear regression for hurricane season in Asheville

#log data 

ggplot(AVHurricaneData, aes(
  x = dateTime, y = log(`Mean Discharge`))) + 
  geom_point(color = "darkgreen") +
  geom_smooth(method = "lm", color = "white", se = TRUE) +
  labs(
    title = "Log-Transformed Trend in Precipitation During Hurricane Seasons",
    subtitle = "Asheville (1954-2024)",
    x = "Year",
    y = "Log of Mean Precipitation (mm)"
  ) +
  theme_minimal()

#filtering data for years 1980-2024


AVYearFilteredData <- AVHurricaneData %>%
  filter(year(dateTime) >= 1980 & year(dateTime) <= 2024)

#View(AVYearFilteredData)

ggplot(AVYearFilteredData, aes(
  x = dateTime, 
  y = `Mean Discharge`)) +
  geom_point(color = "darkgreen") +
  geom_smooth(method = "lm", color = "black", se = TRUE) +
  labs(
    title = "Trend in Precipitation During Hurricane Seasons (1980-2024)",
    subtitle = "Asheville",
    x = "Year",
    y = "Mean Precipitation (mm)"
  ) +
  theme_minimal()



ggplot(AVYearFilteredData, aes(
  x = dateTime, y = log(`Mean Discharge`))) + 
  geom_point(color = "darkgreen") +
  geom_smooth(method = "lm", color = "black", se = TRUE) +
  labs(
    title = "Log-Transformed Trend in Precipitation During Hurricane Seasons",
    subtitle = "Asheville (180-2024)",
    x = "Year",
    y = "Log of Mean Precipitation (mm)"
  ) +
  theme_minimal()


```

##Sugar Grove Data Visualization##

```{r}


SeasonalCleanedDataSugarGrove <- CleanedDataSugarGrove %>%
  mutate(season = case_when(
    month(dateTime) %in% 7:11 ~ "Hurricane",  # July to November
    month(dateTime) %in% c(12, 1:6) ~ "Frontal"  # December to June
  ))

head(SeasonalCleanedDataSugarGrove)

#Sugar Grove Data is now in frontal and hurricane seasons with a new column
#called seasons 

SGHurricaneData <- SeasonalCleanedDataSugarGrove %>%
  filter(season == "Hurricane")

SGFrontalData <- SeasonalCleanedDataSugarGrove %>%
  filter(season == "Frontal")

#plotting the two seasons 

ggplot(SeasonalCleanedDataSugarGrove, aes(
  x = dateTime, 
  y = `Mean Discharge`, 
  color = season)) +
  geom_point(size = 1) +  # Scatterplot
  labs(
    title = "Mean Daily Discharge During Hurricane and Frontal Seasons",
    subtitle = "Sugar Grove (1954-2024",
    x = "Date",
    y = "Mean Daily Discharge (cfs)",
    color = "Season"
  ) +
  scale_color_manual(values = c("Hurricane" = "darkblue", "Frontal" = "lightblue"))  

#again, not much variance between the two seasons 


ggplot(SGHurricaneData, aes(
  x = dateTime, 
  y = `Mean Discharge`)) +
  geom_point(color = "darkblue") +  # Points for yearly average precipitation
  geom_smooth(method = "lm", color = "white", se = TRUE) +  # Linear regression with confidence interval
  labs(
    title = "Trend in Precipitation During Hurricane Seasons",
    subtitle = "Sugar Grove (1954-2024)",
    x = "Year",
    y = "Mean Precipitation"
  ) +
  theme_minimal()

#plotting a linear regression for hurricane season in Sugar Grove

#log data 

ggplot(SGHurricaneData, aes(
  x = dateTime, y = log(`Mean Discharge`))) + 
  geom_point(color = "darkblue") +
  geom_smooth(method = "lm", color = "white", se = TRUE) +
  labs(
    title = "Log-Transformed Trend in Precipitation During Hurricane Seasons",
    subtitle = "Sugar Grove (1954-2024)",
    x = "Year",
    y = "Log of Mean Precipitation (mm)"
  ) +
  theme_minimal()


#filtering data for years 1980-2024


SGYearFilteredData <- SGHurricaneData %>%
  filter(year(dateTime) >= 1980 & year(dateTime) <= 2024)

#View(SGYearFilteredData)

ggplot(SGYearFilteredData, aes(
  x = dateTime, 
  y = `Mean Discharge`)) +
  geom_point(color = "darkblue") +
  geom_smooth(method = "lm", color = "white", se = TRUE) +
  labs(
    title = "Trend in Precipitation During Hurricane Seasons (1980-2024)",
    subtitle = "Sugar Grove",
    x = "Year",
    y = "Mean Precipitation (mm)"
  ) +
  theme_minimal()



ggplot(SGYearFilteredData, aes(
  x = dateTime, y = log(`Mean Discharge`))) + 
  geom_point(color = "darkblue") +
  geom_smooth(method = "lm", color = "grey", se = TRUE) +
  labs(
    title = "Log-Transformed Trend in Precipitation During Hurricane Seasons",
    subtitle = "Asheville (180-2024)",
    x = "Year",
    y = "Log of Mean Precipitation (mm)"
  ) +
  theme_minimal()


#SGYearFilteredData is the data for the hurricane season for 1980-2024
#Hurricane season is filtered based on outside knowledge (July-November)
#we don't really need frontal season information since Helene happened during 
#hurricane season months

#next steps: I think we could draw out the 2024 year data to look specifically 
#at Helene precipitation 
#Sam will put in the Hazen method function into the code so we can start looking at
#the streamflow characteristics based on the precipitation 



```

```{r 2024 trend Ana Andino}


###HERE###
#Following the last note above: 

Data2024_pg <- SeasonalCleanedDataPigeonRiver %>%
  filter(year(dateTime) == 2024)

Data2024_ash <- SeasonalCleanedDataAsheville %>%
  filter(year(dateTime) == 2024)

Data2024_sg <- SeasonalCleanedDataSugarGrove %>%
  filter(year(dateTime) == 2024)

# First: Pigeon River Precipitation for 2024
ggplot(Data2024_pg, aes(x = dateTime, y = `Total Daily Precipitation (Inches)`)) +
  geom_line(color = "lightblue") +
  geom_vline(xintercept = as.Date("2024-09-24"), linetype = "dashed", color = "black") +
  geom_vline(xintercept = as.Date("2024-09-27"), linetype = "dashed", color = "black") +
  labs(
    title = "Precipitation Trends for 2024 in Pigeon River",
    x = "Date",
    y = "Total Daily Precipitation (Inches)"
  ) +
  theme_minimal()

# Second: Asheville Precipitation for 2024
ggplot(Data2024_ash, aes(x = dateTime, y = `Total Daily Precipitation (Inches)`)) +
  geom_line(color = "lightblue") +
  geom_vline(xintercept = as.Date("2024-09-24"), linetype = "dashed", color = "black") +
  geom_vline(xintercept = as.Date("2024-09-27"), linetype = "dashed", color = "black") +
  labs(
    title = "Precipitation Trends for 2024 in Asheville",
    x = "Date",
    y = "Total Daily Precipitation (Inches)"
  ) +
  theme_minimal()

# Third: Sugar Grove Precipitation for 2024
ggplot(Data2024_sg, aes(x = dateTime, y = `Total Daily Precipitation (Inches)`)) +
  geom_line(color = "lightblue") +
  geom_vline(xintercept = as.Date("2024-09-24"), linetype = "dashed", color = "black", size = 2) +
  geom_vline(xintercept = as.Date("2024-09-27"), linetype = "dashed", color = "black", size = 2) +
  labs(
    title = "Precipitation Trends for 2024 in Sugar Grove",
    x = "Date",
    y = "Total Daily Precipitation (Inches)"
  ) +
  theme_minimal()



```


```{r Pigeon River}
# Filtered for Helene's exact dates following what reports mentioned. 
HeleneData_pg <- SeasonalCleanedDataPigeonRiver %>%
  filter(dateTime >= as.Date("2024-09-24") & dateTime <= as.Date("2024-09-27"))

# Compare Helene discharge vs otjer hurricane seasons
AllHurricaneData_pg <- SeasonalCleanedDataPigeonRiver %>%
  filter(season == "Hurricane")

#Plot
ggplot() +
  geom_point(data = AllHurricaneData_pg, aes(x = dateTime, y = `Mean Discharge`), color = "gray", alpha = 0.6) +
  geom_point(data = HeleneData_pg, aes(x = dateTime, y = `Mean Discharge`), color = "red", size = 3) +
  labs(
    title = "Discharge During Hurricane Helene vs. Other Hurricane Seasons in Pigeon River",
    x = "Date",
    y = "Mean Discharge"
  ) +
  theme_minimal()


```


```{r Asheville}
#Same process for Asheville
HeleneData_ash <- SeasonalCleanedDataAsheville %>%
  filter(dateTime >= as.Date("2024-09-24") & dateTime <= as.Date("2024-09-27"))

AllHurricaneData_ash <- SeasonalCleanedDataAsheville %>%
  filter(season == "Hurricane")

library(ggplot2)
ggplot() +
  geom_point(data = AllHurricaneData_ash, aes(x = dateTime, y = `Mean Discharge`), color = "gray", alpha = 0.6) +
  geom_point(data = HeleneData_ash, aes(x = dateTime, y = `Mean Discharge`), color = "red", size = 3) +
  labs(
    title = "Discharge During Hurricane Helene vs. Other Hurricane Seasons in Asheville",
    x = "Date",
    y = "Mean Discharge"
  ) +
  theme_minimal()


```

```{r AnaG SugarGrove}
# Same for Sugar Grove 
HeleneData_sg <- SeasonalCleanedDataSugarGrove %>%
  filter(dateTime >= as.Date("2024-09-24") & dateTime <= as.Date("2024-09-27"))

AllHurricaneData_sg <- SeasonalCleanedDataSugarGrove %>%
  filter(season == "Hurricane")

library(ggplot2)
ggplot() +
  geom_point(data = AllHurricaneData_sg, aes(x = dateTime, y = `Mean Discharge`), color = "gray", alpha = 0.6) +
  geom_point(data = HeleneData_sg, aes(x = dateTime, y = `Mean Discharge`), color = "red", size = 3) +
  labs(
    title = "Discharge During Hurricane Helene vs. Other Hurricane Seasons in Asheville",
    x = "Date",
    y = "Mean Discharge"
  ) +
  theme_minimal()


```

```{r all cobined}
#combined the data in the 3 chunks above to look at it aggregated 
HeleneCombined_test <- bind_rows(
  mutate(HeleneData_pg, Location = "Pigeon River"),
  mutate(HeleneData_ash, Location = "Asheville"),
  mutate(HeleneData_sg, Location = "Sugar Grove")
)

ggplot(HeleneCombined_test, aes(x = dateTime, y = `Mean Discharge`, color = Location)) +
  geom_line() +
  labs(
    title = "Discharge During Hurricane Helene Across Locations",
    x = "Date",
    y = "Mean Discharge (cubic meters per second)",
    color = "Location"
  ) +
  theme_minimal()


#Not sure if this is useful to be honest

```

*Important* Interesting that Asheville has NAs for 3 days during Hurricane Helene. 


```{r Visualization onf precipitation and discharge}


# Pigeon River Visualization
ggplot(HeleneData_pg, aes(x = dateTime)) +
  geom_line(aes(y = `Mean Discharge`), color = "lightblue", size = 1) +
  geom_line(aes(y = `Total Daily Precipitation (Inches)`), color = "blue", linetype = "dashed") +
  scale_y_continuous(
    name = "Mean Discharge (cubic meters per second)",
    sec.axis = sec_axis(~./100, name = "Precipitation (Inches)")
  ) +
  labs(
    title = "Discharge and Precipitation During Hurricane Helene in Pigeon River",
    x = "Date"
  ) +
  theme_minimal()

# Asheville Visualization
ggplot(HeleneData_ash, aes(x = dateTime)) +
  geom_line(aes(y = `Mean Discharge`), color = "lightblue", size = 1) +
  geom_line(aes(y = `Total Daily Precipitation (Inches)`), color = "blue", linetype = "dashed") +
  scale_y_continuous(
    name = "Mean Discharge (cubic meters per second)",
    sec.axis = sec_axis(~./100, name = "Precipitation (Inches)")
  ) +
  labs(
    title = "Discharge and Precipitation During Hurricane Helene in Asheville",
    x = "Date"
  ) +
  theme_minimal()

# Sugar Grove Visualization
ggplot(HeleneData_sg, aes(x = dateTime)) +
  geom_line(aes(y = `Mean Discharge`), color = "lightblue", size = 1) +
  geom_line(aes(y = `Total Daily Precipitation (Inches)`), color = "blue", linetype = "dashed") +
  scale_y_continuous(
    name = "Mean Discharge (cubic meters per second)",
    sec.axis = sec_axis(~./100, name = "Precipitation (Inches)")
  ) +
  labs(
    title = "Discharge and Precipitation During Hurricane Helene in Sugar Grove",
    x = "Date"
  ) +
  theme_minimal()

# Combined Visualization 

ggplot(HeleneCombined_plot, aes(x = dateTime, color = Location)) +
  geom_line(aes(y = `Mean Discharge`), size = 1) +
  geom_line(aes(y = `Total Daily Precipitation (Inches)`, linetype = "dashed"), size = 1) +
  scale_y_continuous(
    name = "Mean Discharge (cubic meters per second)",
    sec.axis = sec_axis(~./100, name = "Precipitation (Inches)")
  ) +
  labs(
    title = "Discharge and Precipitation During Hurricane Helene Across Sugar Grove, Asheville, and Pigeon",
    x = "Date",
    color = "Location"
  ) +
  theme_minimal()

```


```{r Expanded Dates around Helene}

# Since I could't see a trend the days before and after, I expanded the dates to be plotted (10 days before and after)


ExpandedDate_pg <- SeasonalCleanedDataPigeonRiver %>%
  filter(dateTime >= as.Date("2024-09-14") & dateTime <= as.Date("2024-10-07"))

ExpandedDate_ash <- SeasonalCleanedDataAsheville %>%
  filter(dateTime >= as.Date("2024-09-14") & dateTime <= as.Date("2024-10-07"))

ExpandedDate_sg <- SeasonalCleanedDataSugarGrove %>%
  filter(dateTime >= as.Date("2024-09-14") & dateTime <= as.Date("2024-10-07"))


# Pigeon River Visualization
ggplot(ExpandedDate_pg, aes(x = dateTime)) +
  geom_line(aes(y = `Mean Discharge`), color = "lightblue", size = 1) +
  geom_line(aes(y = `Total Daily Precipitation (Inches)`), color = "blue", linetype = "dashed") +
  scale_y_continuous(
    name = "Mean Discharge (cubic meters per second)",
    sec.axis = sec_axis(~./100, name = "Precipitation (Inches)")
  ) +
  labs(
    title = "Discharge and Precipitation Trends Around Hurricane Helene in Pigeon River",
    subtitle = "Including 10 Days Before and After",
    x = "Date"
  ) +
  theme_minimal()

# Asheville Visualization
ggplot(ExpandedDate_ash, aes(x = dateTime)) +
  geom_line(aes(y = `Mean Discharge`), color = "lightblue", size = 1) +
  geom_line(aes(y = `Total Daily Precipitation (Inches)`), color = "blue", linetype = "dashed") +
  scale_y_continuous(
    name = "Mean Discharge (cubic meters per second)",
    sec.axis = sec_axis(~./100, name = "Precipitation (Inches)")
  ) +
  labs(
    title = "Discharge and Precipitation Trends Around Hurricane Helene in Asheville",
    subtitle = "Including 10 Days Before and After",
    x = "Date"
  ) +
  theme_minimal()

# Sugar Grove Visualization
ggplot(ExpandedDate_sg, aes(x = dateTime)) +
  geom_line(aes(y = `Mean Discharge`), color = "lightblue", size = 1) +
  geom_line(aes(y = `Total Daily Precipitation (Inches)`), color = "blue", linetype = "dashed") +
  scale_y_continuous(
    name = "Mean Discharge (cubic meters per second)",
    sec.axis = sec_axis(~./100, name = "Precipitation (Inches)")
  ) +
  labs(
    title = "Discharge and Precipitation Trends Around Hurricane Helene in Sugar Grove",
    subtitle = "Including 10 Days Before and After",
    x = "Date"
  ) +
  theme_minimal()

# Combined Visualization for All Locations
ExpandedCombined <- bind_rows(
  mutate(ExpandedDate_pg, Location = "Pigeon River"),
  mutate(ExpandedDate_ash, Location = "Asheville"),
  mutate(ExpandedDate_sg, Location = "Sugar Grove")
)

ggplot(ExpandedCombined, aes(x = dateTime, color = Location)) +
  geom_line(aes(y = `Mean Discharge`), size = 1) +
  geom_line(aes(y = `Total Daily Precipitation (Inches)`, linetype = "dashed"), size = 1) +
  scale_y_continuous(
    name = "Mean Discharge (cubic meters per second)",
    limits = c(0, 22000),
    sec.axis = sec_axis(~./100, name = "Precipitation (Inches)")
  ) +
  labs(
    title = "Discharge and Precipitation Trends Across Locations Around Hurricane Helene",
    subtitle = "Including 10 Days Before and After",
    x = "Date",
    color = "Location"
  ) +
  theme_minimal()

```
```{r}
library(gganimate)

ggplot(AllData2024, aes(x = Location, y = `Mean Discharge`, fill = Location)) +
  geom_boxplot() +
  labs(
    title = "Flood Discharge Comparison Across Locations",
    x = "Location",
    y = "Mean Discharge (cubic meters per second)",
    fill = "Location"
  ) +
  theme_minimal()

##is this useful?

```

I will try to do some maps as well eventually.. 
```{r}

library(leaflet)

locations <- data.frame(
  Location = c("Pigeon River", "Asheville", "Sugar Grove"),
  Latitude = c(35.554, 35.595, 36.267),
  Longitude = c(-82.982, -82.551, -81.785),
  Precipitation = c(max(Data2024_pg$`Total Daily Precipitation (Inches)`, na.rm = TRUE),
                    max(Data2024_ash$`Total Daily Precipitation (Inches)`, na.rm = TRUE),
                    max(Data2024_sg$`Total Daily Precipitation (Inches)`, na.rm = TRUE)),
  Discharge = c(max(Data2024_pg$`Mean Discharge`, na.rm = TRUE),
                max(Data2024_ash$`Mean Discharge`, na.rm = TRUE),
                max(Data2024_sg$`Mean Discharge`, na.rm = TRUE))
)

leaflet(locations) %>%
  addTiles() %>%
  addCircleMarkers(
    ~Longitude, ~Latitude,
    label = ~paste0(Location, "<br>Precipitation: ", Precipitation, " in",
                    "<br>Discharge: ", Discharge, " mÂ³/s"),
    radius = 8,
    color = "blue",
    fillOpacity = 0.7
  ) %>%
  addLegend("bottomright", colors = "blue", labels = "Monitoring Sites", title = "Legend")

# Just go show off we can start with this map to show the locations. I cant think of what other map to do 

```

hi everyone this is the hazen analysis

```{r SugarGrove Stream Flow Hazen}

library(zoo)

SugarGroveFlood <- CleanedDataSugarGrove %>% 
  mutate(moving_avg = rollapply(`Mean Discharge`, width = 7, FUN = mean, align = "center", fill = NA)) 

SugarGroveFlood <- SugarGroveFlood %>%
  mutate(Year = year(dateTime))

SugarGroveFlood <- SugarGroveFlood %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm=T))

SugarGroveFlood <- SugarGroveFlood %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100*(2*rank - 1))/(2*n()))) %>% 
  mutate(hazen = 100/Fa_Value)

SugarGroveDischargeHazen_2024 <- SugarGroveFlood %>% filter(Year == 2024)
print(SugarGroveDischargeHazen_2024)


```


```{r Asheville Streamflow Hazen}

AshevilleFlood <- CleanedDataAsheville %>% 
  mutate(moving_avg = rollapply(`Mean Discharge`, width = 7, FUN = mean, align = "center", fill = NA)) 

AshevilleFlood <- AshevilleFlood %>%
  mutate(Year = year(dateTime))

AshevilleFlood <- AshevilleFlood %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm=T))

AshevilleFlood <- AshevilleFlood %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100*(2*rank - 1))/(2*n()))) %>% 
  mutate(hazen = 100/Fa_Value)


AshevilleDischargeHazen_2024 <- AshevilleFlood %>% filter(Year == 2024)
print(AshevilleDischargeHazen_2024)
```

```{r Pigeon Grove Streamflow }


PigeonRiverFlood <- CleanedDataPigeonRiver %>% 
  mutate(moving_avg = rollapply(`Mean Discharge`, width = 7, FUN = mean, align = "center", fill = NA)) 

PigeonRiverFlood <- PigeonRiverFlood %>%
  mutate(Year = year(dateTime))

PigeonRiverFlood <- PigeonRiverFlood%>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm=T))

PigeonRiverFlood <- PigeonRiverFlood %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100*(2*rank - 1))/(2*n()))) %>% 
  mutate(hazen = 100/Fa_Value)

PigeonRiverDischargeHazen_2024 <- PigeonRiverFlood %>% filter(Year == 2024)
print(PigeonRiverDischargeHazen_2024)


```
```{r SugarGrove Precip Hazen}
SugarGrovePrecip <- CleanedDataSugarGrove %>% 
  mutate(moving_avg = rollapply(`Total Daily Precipitation (Inches)`, width = 7, FUN = mean, align = "center", fill = NA)) 

SugarGrovePrecip <- SugarGrovePrecip %>%
  mutate(Year = year(dateTime))

SugarGrovePrecip <- SugarGrovePrecip %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm=T))

SugarGrovePrecip <- SugarGrovePrecip %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100*(2*rank - 1))/(2*9))) %>% 
  mutate(hazen = 100/Fa_Value)

SugarGrovePrecipHazen_2024 <- SugarGrovePrecip %>% filter(Year == 2024)
print(SugarGrovePrecipHazen_2024)



```

```{r Asheville Precip Hazen}

AshevillePrecip <- CleanedDataAsheville %>% 
  mutate(moving_avg = rollapply(`Total Daily Precipitation (Inches)`, width = 7, FUN = mean, align = "center", fill = NA)) 

AshevillePrecip <- AshevillePrecip %>%
  mutate(Year = year(dateTime))

AshevillePrecip <- AshevillePrecip %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm = TRUE))

AshevillePrecip <- AshevillePrecip %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100 * (2 * rank - 1)) / (2 * 27))) %>% 
  mutate(hazen = 100 / Fa_Value)

AshevillePrecipHazen_2024 <- AshevillePrecip %>% filter(Year == 2024)
print(AshevillePrecipHazen_2024)

```
```{r Pigeon River Precip Hazen}

PigeonRiverPrecip <- CleanedDataPigeonRiver %>% 
  mutate(moving_avg = rollapply(`Total Daily Precipitation (Inches)`, width = 7, FUN = mean, align = "center", fill = NA)) 

PigeonRiverPrecip <- PigeonRiverPrecip %>%
  mutate(Year = year(dateTime))

PigeonRiverPrecip <- PigeonRiverPrecip %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm = TRUE))

PigeonRiverPrecip <- PigeonRiverPrecip %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100 * (2 * rank - 1)) / (2 * 25))) %>% 
  mutate(hazen = 100 / Fa_Value)

PigeonRiverPrecipHazen_2024 <- PigeonRiverPrecip %>% filter(Year == 2024)
print(PigeonRiverPrecipHazen_2024)



```
```{r Sugar Grove Gage Height Hazen}
SugarGroveGageHeight <- CleanedDataSugarGrove %>% 
  mutate(moving_avg = rollapply(`Mean Gage Height`, width = 7, FUN = mean, align = "center", fill = NA)) 

SugarGroveGageHeight <- SugarGroveGageHeight %>%
  mutate(Year = year(dateTime))

SugarGroveGageHeight <- SugarGroveGageHeight %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm = TRUE))

SugarGroveGageHeight <- SugarGroveGageHeight %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100 * (2 * rank - 1)) / (2 * 29))) %>% 
  mutate(hazen = 100 / Fa_Value)

SugarGroveGageHeightHazen_2024 <- SugarGroveGageHeight %>% filter(Year == 2024)
print(SugarGroveGageHeightHazen_2024)


```


```{r Asheville Gage Heigt Hazen}
AshevilleGageHeight <- CleanedDataAsheville %>% 
  mutate(moving_avg = rollapply(`Mean Gage Height`, width = 7, FUN = mean, align = "center", fill = NA)) 

AshevilleGageHeight <- AshevilleGageHeight %>%
  mutate(Year = year(dateTime))

AshevilleGageHeight <- AshevilleGageHeight %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm = TRUE))

AshevilleGageHeight <- AshevilleGageHeight %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100 * (2 * rank - 1)) / (2 * 39))) %>% 
  mutate(hazen = 100 / Fa_Value)

AshevilleGageHeightHazen_2024 <- AshevilleGageHeight %>% filter(Year == 2024)
print(AshevilleGageHeightHazen_2024)




```

```{r Pigeon River Gage Heigh Hazen}

PigeonRiverGageHeight <- CleanedDataPigeonRiver %>% 
  mutate(moving_avg = rollapply(`Mean Gage Height`, width = 7, FUN = mean, align = "center", fill = NA)) 

PigeonRiverGageHeight <- PigeonRiverGageHeight %>%
  mutate(Year = year(dateTime))

PigeonRiverGageHeight <- PigeonRiverGageHeight %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm = TRUE))

PigeonRiverGageHeight <- PigeonRiverGageHeight %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100 * (2 * rank - 1)) / (2 * 29))) %>% 
  mutate(hazen = 100 / Fa_Value)

PigeonRiverGageHeightHazen_2024 <- PigeonRiverGageHeight %>% filter(Year == 2024)
print(PigeonRiverGageHeightHazen_2024)
```

```{r DECOMPOSITION PLOTS: Chrissie-ASHEVILLE}

library(dplyr)
library(lubridate)
library(zoo)

# Convert dateTime to Date class
CleanedDataAsheville <- CleanedDataAsheville %>%
  mutate(
    dateTime = as.Date(dateTime),
    mean_discharge = as.numeric(`Mean Discharge`),
    `Mean Gage Height` = as.numeric(`Mean Gage Height`),
    `Total Daily Precipitation (Inches)` = as.numeric(`Total Daily Precipitation (Inches)`)
  )

# Fill missing Mean Discharge values
CleanedDataAsheville.clean <- CleanedDataAsheville %>%
  mutate(
    Mean.Discharge.clean = zoo::na.approx(mean_discharge, na.rm = FALSE)
  )

# Generate time series objects
CleanedDataAsheville.monthly <- CleanedDataAsheville.clean %>%
  filter(!is.na(mean_discharge))

# Step 1: Add columns for year and month, then calculate monthly mean discharge
CleanedDataAsheville.monthly <- CleanedDataAsheville.clean %>%
  mutate(
    year = year(dateTime),   # Extract year from dateTime
    month = month(dateTime)  # Extract month from dateTime
  ) %>%
  group_by(year, month) %>%
  summarize(
    mean_discharge = mean(Mean.Discharge.clean, na.rm = TRUE)
  ) %>%
  ungroup()

# Step 2: Create a new Date column for graphing, setting each month-year combination to the first day of the month
CleanedDataAsheville.monthly <- CleanedDataAsheville.monthly %>%
  mutate(
    dateTime = as.Date(paste(year, month, "01", sep = "-")))

# Extract start and end years and months
s_year <- year(first(CleanedDataAsheville$dateTime))
f_year <- year(last(CleanedDataAsheville$dateTime))
s_month <- month(first(CleanedDataAsheville$dateTime))
f_month <- month(last(CleanedDataAsheville$dateTime))

# 1. Generate the daily time series object
CleanedDataAsheville.daily.ts <- ts(
  CleanedDataAsheville.clean$Mean.Discharge.clean,
  start = c(s_year, s_month),
  end = c(f_year, f_month),
  frequency = 365
)

# 2. Generate the monthly time series object using aggregated data
CleanedDataAsheville.monthly.ts <- ts(
  CleanedDataAsheville.monthly$mean_discharge,
  start = c(s_year, s_month),
  end = c(f_year, f_month),
  frequency = 12
)

# Display the created time series
CleanedDataAsheville.daily.ts
CleanedDataAsheville.monthly.ts

# Decompose the daily time series
CleanedDataAsheville.daily.decomp <- stl(CleanedDataAsheville.daily.ts, s.window = "periodic")

# Plot the components of the daily decomposition
plot(CleanedDataAsheville.daily.decomp, main = "Decomposition of Daily Discharge for Asheville")

# Decompose the monthly time series
CleanedDataAsheville.monthly.decomp <- stl(CleanedDataAsheville.monthly.ts, s.window = "periodic")

# Plot the components of the monthly decomposition
plot(CleanedDataAsheville.monthly.decomp, main = "Decomposition of Monthly Discharge for Asheville")


```

```{r DECOMPOSITION PLOTS: Chrissie-PIGEON RIVER}

library(dplyr)
library(lubridate)
library(zoo)

# Convert dateTime to Date class
CleanedDataPigeonRiver <- CleanedDataPigeonRiver %>%
  mutate(
    dateTime = as.Date(dateTime),
    mean_discharge = as.numeric(`Mean Discharge`),
    `Mean Gage Height` = as.numeric(`Mean Gage Height`),
    `Total Daily Precipitation (Inches)` = as.numeric(`Total Daily Precipitation (Inches)`)
  )

# Fill missing Mean Discharge values
CleanedDataPigeonRiver.clean <- CleanedDataPigeonRiver %>%
  mutate(
    Mean.Discharge.clean = zoo::na.approx(mean_discharge, na.rm = FALSE)
  )

# Generate time series objects
CleanedDataPigeonRiver.monthly <- CleanedDataPigeonRiver.clean %>%
  filter(!is.na(mean_discharge))

# Step 1: Add columns for year and month, then calculate monthly mean discharge
CleanedDataPigeonRiver.monthly <- CleanedDataPigeonRiver.clean %>%
  mutate(
    year = year(dateTime),   # Extract year from dateTime
    month = month(dateTime)  # Extract month from dateTime
  ) %>%
  group_by(year, month) %>%
  summarize(
    mean_discharge = mean(Mean.Discharge.clean, na.rm = TRUE)
  ) %>%
  ungroup()

# Step 2: Create a new Date column for graphing, setting each month-year combination to the first day of the month
CleanedDataPigeonRiver.monthly <- CleanedDataPigeonRiver.monthly %>%
  mutate(
    dateTime = as.Date(paste(year, month, "01", sep = "-")))

# Extract start and end years and months
s_year <- year(first(CleanedDataPigeonRiver$dateTime))
f_year <- year(last(CleanedDataPigeonRiver$dateTime))
s_month <- month(first(CleanedDataPigeonRiver$dateTime))
f_month <- month(last(CleanedDataPigeonRiver$dateTime))

# 1. Generate the daily time series object
CleanedDataPigeonRiver.daily.ts <- ts(
  CleanedDataPigeonRiver.clean$Mean.Discharge.clean,
  start = c(s_year, s_month),
  end = c(f_year, f_month),
  frequency = 365
)

# 2. Generate the monthly time series object using aggregated data
CleanedDataPigeonRiver.monthly.ts <- ts(
  CleanedDataPigeonRiver.monthly$mean_discharge,
  start = c(s_year, s_month),
  end = c(f_year, f_month),
  frequency = 12
)

# Display the created time series
CleanedDataPigeonRiver.daily.ts
CleanedDataPigeonRiver.monthly.ts

# Decompose the daily time series
CleanedDataPigeonRiver.daily.decomp <- stl(CleanedDataPigeonRiver.daily.ts, s.window = "periodic")

# Plot the components of the daily decomposition
plot(CleanedDataPigeonRiver.daily.decomp, main = "Decomposition of Daily Discharge for Pigeon River")

# Decompose the monthly time series
CleanedDataPigeonRiver.monthly.decomp <- stl(CleanedDataPigeonRiver.monthly.ts, s.window = "periodic")

# Plot the components of the monthly decomposition
plot(CleanedDataPigeonRiver.monthly.decomp, main = "Decomposition of Monthly Discharge for Pigeon River")

```

```{r DECOMPOSITION PLOTS: Chrissie-SUGAR GROVE}

library(dplyr)
library(lubridate)
library(zoo)

# Convert dateTime to Date class
CleanedDataSugarGrove <- CleanedDataSugarGrove %>%
  mutate(
    dateTime = as.Date(dateTime),
    mean_discharge = as.numeric(`Mean Discharge`),
    `Mean Gage Height` = as.numeric(`Mean Gage Height`),
    `Total Daily Precipitation (Inches)` = as.numeric(`Total Daily Precipitation (Inches)`)
  )

# Fill missing Mean Discharge values
CleanedDataSugarGrove.clean <- CleanedDataSugarGrove %>%
  mutate(
    Mean.Discharge.clean = zoo::na.approx(mean_discharge, na.rm = FALSE)
  )

# Generate time series objects
CleanedDataSugarGrove.monthly <- CleanedDataSugarGrove.clean %>%
  filter(!is.na(mean_discharge))

# Step 1: Add columns for year and month, then calculate monthly mean discharge
CleanedDataSugarGrove.monthly <- CleanedDataSugarGrove.clean %>%
  mutate(
    year = year(dateTime),   # Extract year from dateTime
    month = month(dateTime)  # Extract month from dateTime
  ) %>%
  group_by(year, month) %>%
  summarize(
    mean_discharge = mean(Mean.Discharge.clean, na.rm = TRUE)
  ) %>%
  ungroup()

# Step 2: Create a new Date column for graphing, setting each month-year combination to the first day of the month
CleanedDataSugarGrove.monthly <- CleanedDataSugarGrove.monthly %>%
  mutate(
    dateTime = as.Date(paste(year, month, "01", sep = "-")))

# Extract start and end years and months
s_year <- year(first(CleanedDataSugarGrove$dateTime))
f_year <- year(last(CleanedDataSugarGrove$dateTime))
s_month <- month(first(CleanedDataSugarGrove$dateTime))
f_month <- month(last(CleanedDataSugarGrove$dateTime))

# 1. Generate the daily time series object
CleanedDataSugarGrove.daily.ts <- ts(
  CleanedDataSugarGrove.clean$Mean.Discharge.clean,
  start = c(s_year, s_month),
  end = c(f_year, f_month),
  frequency = 365
)

# 2. Generate the monthly time series object using aggregated data
CleanedDataSugarGrove.monthly.ts <- ts(
  CleanedDataSugarGrove.monthly$mean_discharge,
  start = c(s_year, s_month),
  end = c(f_year, f_month),
  frequency = 12
)

# Display the created time series
CleanedDataSugarGrove.daily.ts
CleanedDataSugarGrove.monthly.ts

# Decompose the daily time series
CleanedDataSugarGrove.daily.decomp <- stl(CleanedDataSugarGrove.daily.ts, s.window = "periodic")

# Plot the components of the daily decomposition
plot(CleanedDataSugarGrove.daily.decomp, main = "Decomposition of Daily Discharge for Sugar Grove")

# Decompose the monthly time series
CleanedDataSugarGrove.monthly.decomp <- stl(CleanedDataSugarGrove.monthly.ts, s.window = "periodic")

# Plot the components of the monthly decomposition
plot(CleanedDataSugarGrove.monthly.decomp, main = "Decomposition of Monthly Discharge for Sugar Grove")

```


hi everyone this is the hazen analysis
```{r SugarGrove Stream Flow Hazen}

library(zoo)

SugarGroveFlood <- CleanedDataSugarGrove %>% 
  mutate(moving_avg = rollapply(`Mean Discharge`, width = 7, FUN = mean, align = "center", fill = NA)) 

SugarGroveFlood <- SugarGroveFlood %>%
  mutate(Year = year(dateTime))

SugarGroveFlood <- SugarGroveFlood %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm=T))


SugarGroveFlood <- SugarGroveFlood %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100*(2*rank - 1))/(2*n()))) %>% 
  mutate(hazen = 100/Fa_Value)

SugarGroveDischargeHazen_2024 <- SugarGroveFlood %>% filter(Year == 2024)
print(SugarGroveDischargeHazen_2024)


```


```{r Asheville Streamflow Hazen}

AshevilleFlood <- CleanedDataAsheville %>% 
  mutate(moving_avg = rollapply(`Mean Discharge`, width = 7, FUN = mean, align = "center", fill = NA)) 

AshevilleFlood <- AshevilleFlood %>%
  mutate(Year = year(dateTime))

AshevilleFlood <- AshevilleFlood %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm=T))

AshevilleFlood <- AshevilleFlood %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100*(2*rank - 1))/(2*n()))) %>% 
  mutate(hazen = 100/Fa_Value)


AshevilleDischargeHazen_2024 <- AshevilleFlood %>% filter(Year == 2024)
print(AshevilleDischargeHazen_2024)
```

```{r Pigeon Grove Streamflow }


PigeonRiverFlood <- CleanedDataPigeonRiver %>% 
  mutate(moving_avg = rollapply(`Mean Discharge`, width = 7, FUN = mean, align = "center", fill = NA)) 

PigeonRiverFlood <- PigeonRiverFlood %>%
  mutate(Year = year(dateTime))

PigeonRiverFlood <- PigeonRiverFlood%>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm=T))

PigeonRiverFlood <- PigeonRiverFlood %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100*(2*rank - 1))/(2*n()))) %>% 
  mutate(hazen = 100/Fa_Value)

PigeonRiverDischargeHazen_2024 <- PigeonRiverFlood %>% filter(Year == 2024)
print(PigeonRiverDischargeHazen_2024)
```

```{r SugarGrove Precip Hazen}
SugarGrovePrecip <- CleanedDataSugarGrove %>% 
  mutate(moving_avg = rollapply(`Total Daily Precipitation (Inches)`, width = 7, FUN = mean, align = "center", fill = NA)) 

SugarGrovePrecip <- SugarGrovePrecip %>%
  mutate(Year = year(dateTime))

SugarGrovePrecip <- SugarGrovePrecip %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm=T))

SugarGrovePrecip <- SugarGrovePrecip %>% 
  filter(MaxEvent > 0)

SugarGrovePrecip <- SugarGrovePrecip %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100*(2*rank - 1))/(2*n()))) %>% 
  mutate(hazen = 100/Fa_Value)

SugarGrovePrecipHazen_2024 <- SugarGrovePrecip %>% filter(Year == 2024)
print(SugarGrovePrecipHazen_2024)
```

```{r Asheville Precip Hazen}

AshevillePrecip <- CleanedDataAsheville %>% 
  mutate(moving_avg = rollapply(`Total Daily Precipitation (Inches)`, width = 7, FUN = mean, align = "center", fill = NA)) 

AshevillePrecip <- AshevillePrecip %>%
  mutate(Year = year(dateTime))

AshevillePrecip <- AshevillePrecip %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm = TRUE))

AshevillePrecip <- AshevillePrecip %>% 
  filter(MaxEvent > 0)

AshevillePrecip <- AshevillePrecip %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100 * (2 * rank - 1)) / (2 * n()))) %>% 
  mutate(hazen = 100 / Fa_Value)

AshevillePrecipHazen_2024 <- AshevillePrecip %>% filter(Year == 2024)
print(AshevillePrecipHazen_2024)
```

```{r Pigeon River Precip Hazen}

PigeonRiverPrecip <- CleanedDataPigeonRiver %>% 
  mutate(moving_avg = rollapply(`Total Daily Precipitation (Inches)`, width = 7, FUN = mean, align = "center", fill = NA)) 

PigeonRiverPrecip <- PigeonRiverPrecip %>%
  mutate(Year = year(dateTime))

PigeonRiverPrecip <- PigeonRiverPrecip %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm = TRUE))

PigeonRiverPrecip <- PigeonRiverPrecip  %>% 
  filter(MaxEvent > 0)

PigeonRiverPrecip <- PigeonRiverPrecip %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100 * (2 * rank - 1)) / (2 * n()))) %>% 
  mutate(hazen = 100 / Fa_Value)

PigeonRiverPrecipHazen_2024 <- PigeonRiverPrecip %>% filter(Year == 2024)
print(PigeonRiverPrecipHazen_2024)

{r Sugar Grove Gage Height Hazen}
SugarGroveGageHeight <- CleanedDataSugarGrove %>% 
  mutate(moving_avg = rollapply(`Mean Gage Height`, width = 7, FUN = mean, align = "center", fill = NA)) 

SugarGroveGageHeight <- SugarGroveGageHeight %>%
  mutate(Year = year(dateTime))

SugarGroveGageHeight <- SugarGroveGageHeight %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm = TRUE))

SugarGroveGageHeight <- SugarGroveGageHeight %>% 
  filter(MaxEvent > 0)

SugarGroveGageHeight <- SugarGroveGageHeight %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100 * (2 * rank - 1)) / (2 * n()))) %>% 
  mutate(hazen = 100 / Fa_Value)

SugarGroveGageHeightHazen_2024 <- SugarGroveGageHeight %>% filter(Year == 2024)
print(SugarGroveGageHeightHazen_2024)
```


```{r Asheville Gage Height Hazen}
AshevilleGageHeight <- CleanedDataAsheville %>% 
  mutate(moving_avg = rollapply(`Mean Gage Height`, width = 7, FUN = mean, align = "center", fill = NA)) 

AshevilleGageHeight <- AshevilleGageHeight %>%
  mutate(Year = year(dateTime))

AshevilleGageHeight <- AshevilleGageHeight %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm = TRUE))

AshevilleGageHeight <- AshevilleGageHeight %>% 
  filter(MaxEvent > 0)

AshevilleGageHeight <- AshevilleGageHeight %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100 * (2 * rank - 1)) / (2 * n()))) %>% 
  mutate(hazen = 100 / Fa_Value)

AshevilleGageHeightHazen_2024 <- AshevilleGageHeight %>% filter(Year == 2024)
print(AshevilleGageHeightHazen_2024)
```


```{r Pigeon River Gage Heigh Hazen}

PigeonRiverGageHeight <- CleanedDataPigeonRiver %>% 
  mutate(moving_avg = rollapply(`Mean Gage Height`, width = 7, FUN = mean, align = "center", fill = NA)) 

PigeonRiverGageHeight <- PigeonRiverGageHeight %>%
  mutate(Year = year(dateTime))

PigeonRiverGageHeight <- PigeonRiverGageHeight %>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm = TRUE))

PigeonRiverGageHeight <- PigeonRiverGageHeight %>% 
  filter(MaxEvent > 0)

PigeonRiverGageHeight <- PigeonRiverGageHeight %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100 * (2 * rank - 1)) / (2 * n()))) %>% 
  mutate(hazen = 100 / Fa_Value)

PigeonRiverGageHeightHazen_2024 <- PigeonRiverGageHeight %>% filter(Year == 2024)
print(PigeonRiverGageHeightHazen_2024)
```


Ok this is my attempt to create an automated function so that we can plug in a site no and get
the 2024 Hazen number for each parameter

```{r functions for streamflow}

Hazen2024Flood.Function<-function(siteNo, pcode, scode){

SiteData<-readNWISdata(
  siteNumbers = siteNo,
  parameterCd= pcode,
  statCd= scode,
  startDate= ymd('1900-01-01'),
  endDate= Sys.Date()
)

  CleanData<-SiteData%>% 
select(-ends_with("cd")) %>% #removing cd columns that indiciate provisional or offical data
  rename(
  'Total Daily Precipitation (Inches)' = X_00045_00006, #renaming columns
    'Mean Discharge' = X_00060_00003,
    'Mean Gage Height' = X_00065_00003
  )
  
CleanDataFlood<-CleanData%>% 
  mutate(moving_avg = rollapply(`Mean Discharge`, width = 7, FUN = mean, align = "center", fill = NA)) 

CleanDataFlood<- CleanDataFlood%>%
  mutate(Year = year(dateTime))

CleanDataFlood <- CleanDataFlood%>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm=T))

CleanDataFlood <- CleanDataFlood %>% 
  filter(MaxEvent > 0)

CleanDataFlood <- CleanDataFlood %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100*(2*rank - 1))/(2*n()))) %>% 
  mutate(hazen = 100/Fa_Value)

CleanDataFlood2024 <- CleanDataFlood %>% filter(Year == 2024)


return(CleanDataFlood2024)
}


#testing function

SugarGroveFloodHazen2024<-Hazen2024Flood.Function(siteNumberSugarGrove, pcode, scode)
AshevilleFloodHazen2024<-Hazen2024Flood.Function(siteNumberAsheville, pcode, scode)
PigeonRiverFloodHazen2024<-Hazen2024.Function(siteNoPigeonRiver, pcode, scode)
```

```{r function for precip}

Hazen2024Precip.Function<-function(siteNo, pcode, scode){

SiteData<-readNWISdata(
  siteNumbers = siteNo,
  parameterCd= pcode,
  statCd= scode,
  startDate= ymd('1900-01-01'),
  endDate= Sys.Date()
)

  CleanData<-SiteData%>% 
select(-ends_with("cd")) %>% #removing cd columns that indiciate provisional or offical data
  rename(
  'Total Daily Precipitation (Inches)' = X_00045_00006, #renaming columns
    'Mean Discharge' = X_00060_00003,
    'Mean Gage Height' = X_00065_00003
  )
  
CleanDataPrecip<-CleanData%>% 
  mutate(moving_avg = rollapply(`Total Daily Precipitation (Inches)`, width = 7, FUN = mean, align = "center", fill = NA)) 

CleanDataPrecip<- CleanDataPrecip%>%
  mutate(Year = year(dateTime))

CleanDataPrecip <- suppressWarnings(CleanDataPrecip%>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm=T))
)

CleanDataPrecip <- CleanDataPrecip %>% 
  filter(MaxEvent > 0)

CleanDataPrecip <- CleanDataPrecip %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100*(2*rank - 1))/(2*n()))) %>% 
  mutate(hazen = 100/Fa_Value)

CleanDataPrecip2024 <- CleanDataPrecip %>% filter(Year == 2024)




return(CleanDataPrecip2024)
}

#testing function

SugarGrovePrecipHazen2024<-Hazen2024Precip.Function(siteNumberSugarGrove, pcode, scode)
AshevillePrecipHaze024<-Hazen2024Precip.Function(siteNumberAsheville, pcode, scode)
PigeonRiverPrecipHaze2024<-Hazen2024Precip.Function(siteNoPigeonRiver, pcode, scode)
```


```{r function for gageheight}

Hazen2024GageHeight.Function<-function(siteNo, pcode, scode){

SiteData<-readNWISdata(
  siteNumbers = siteNo,
  parameterCd= pcode,
  statCd= scode,
  startDate= ymd('1900-01-01'),
  endDate= Sys.Date()
)

  CleanData<-SiteData%>% 
select(-ends_with("cd")) %>% #removing cd columns that indiciate provisional or offical data
  rename(
  'Total Daily Precipitation (Inches)' = X_00045_00006, #renaming columns
    'Mean Discharge' = X_00060_00003,
    'Mean Gage Height' = X_00065_00003
  )
  
CleanDataGageHeight<-CleanData%>% 
  mutate(moving_avg = rollapply('Mean Gage Height', width = 7, FUN = mean, align = "center", fill = NA)) 

CleanDataGageHeight<- CleanDataGageHeight%>%
  mutate(Year = year(dateTime))

CleanDataGageHeight <- suppressWarnings(CleanDataGageHeight%>% 
  group_by(Year) %>%                  
  summarize(MaxEvent = max(moving_avg, na.rm=T))
)

CleanDataGageHeight <- CleanDataGageHeight %>% 
  filter(MaxEvent > 0)

CleanDataGageHeight <- CleanDataGageHeight %>% 
  arrange(desc(MaxEvent)) %>% 
  mutate(rank = row_number()) %>% 
  mutate(Fa_Value = ((100*(2*rank - 1))/(2*n()))) %>% 
  mutate(hazen = 100/Fa_Value)

CleanDataGageHeight2024 <- CleanDataGageHeight %>% filter(Year == 2024)




return(CleanDataGageHeight2024)
}

#testing function

SugarGroveGageHeightHazen2024<-Hazen2024GageHeight.Function(siteNumberSugarGrove, pcode, scode)
AshevilleGageHeightHaze024<-Hazen2024GageHeight.Function(siteNumberAsheville, pcode, scode)
PigeonRiverGageHeightHaze2024<-Hazen2024Gage
```
